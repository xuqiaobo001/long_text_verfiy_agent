#!/usr/bin/env python3
"""
创建简洁的合同审核要点表格
"""

import pandas as pd
import re

def create_concise_audit_table():
    """创建简洁的审核表格"""

    # 定义关键审核要素
    audit_items = [
        # 合同主体
        {
            '要素类别': '合同主体',
            '审核要点': '发包人名称',
            '合同内容': '济南济阳鑫土置业有限公司',
            '出现章节': '合同协议书',
            '风险等级': '高',
            '审核建议': '核实工商注册信息全称'
        },
        {
            '要素类别': '合同主体',
            '审核要点': '承包人名称',
            '合同内容': '中铁上海工程局集团有限公司（联合体牵头人）',
            '出现章节': '合同协议书',
            '风险等级': '高',
            '审核建议': '核实资质和联合体协议'
        },
        {
            '要素类别': '合同主体',
            '审核要点': '联合体成员',
            '合同内容': '同圆设计集团股份有限公司',
            '出现章节': '合同协议书',
            '风险等级': '高',
            '审核建议': '确认联合体分工协议'
        },

        # 金额条款
        {
            '要素类别': '金额条款',
            '审核要点': '合同总价',
            '合同内容': '约4.11亿元（肆亿壹仟壹佰壹拾玖万）',
            '出现章节': '合同协议书',
            '风险等级': '高',
            '审核建议': '核对大小写一致性'
        },
        {
            '要素类别': '金额条款',
            '审核要点': '固定综合单价',
            '合同内容': '3,536.29元/平方米（不含项目预备金）',
            '出现章节': '合同协议书',
            '风险等级': '中',
            '审核建议': '确认单价包含范围'
        },
        {
            '要素类别': '金额条款',
            '审核要点': '质量保证金',
            '合同内容': '3%的工程款',
            '出现章节': '专用合同条件',
            '风险等级': '中',
            '审核建议': '确认保证金返还条件'
        },

        # 时间节点
        {
            '要素类别': '时间节点',
            '审核要点': '计划开工日期',
            '合同内容': '2025年4月10日（以开工令为准）',
            '出现章节': '合同协议书',
            '风险等级': '中',
            '审核建议': '确认开工令条件'
        },
        {
            '要素类别': '时间节点',
            '审核要点': '计划竣工日期',
            '合同内容': '2028年4月9日',
            '出现章节': '合同协议书',
            '风险等级': '中',
            '审核建议': '确认工期总日历天数：1095天'
        },
        {
            '要素类别': '时间节点',
            '审核要点': '缺陷责任期',
            '合同内容': '24个月',
            '出现章节': '专用合同条件',
            '风险等级': '中',
            '审核建议': '确认起算时间'
        },

        # 质量标准
        {
            '要素类别': '质量标准',
            '审核要点': '设计质量标准',
            '合同内容': '合格；符合现行的国家、省、市、法律、法规及规范要求',
            '出现章节': '合同协议书',
            '风险等级': '中',
            '审核建议': '明确具体规范标准'
        },
        {
            '要素类别': '质量标准',
            '审核要点': '施工质量标准',
            '合同内容': '合格；符合现行的国家、省、市、法律、法规及规范要求',
            '出现章节': '合同协议书',
            '风险等级': '中',
            '审核建议': '明确验收标准'
        },

        # 违约条款
        {
            '要素类别': '违约条款',
            '审核要点': '工期延误赔偿',
            '合同内容': '每日按合同价格的0.02%，累计最高3%',
            '出现章节': '专用合同条件',
            '风险等级': '高',
            '审核建议': '确认赔偿上限合理性'
        },
        {
            '要素类别': '违约条款',
            '审核要点': '人员更换违约金',
            '合同内容': '擅自更换人员每次5万元',
            '出现章节': '专用合同条件',
            '风险等级': '低',
            '审核建议': '确认违约金合理性'
        },
        {
            '要素类别': '违约条款',
            '审核要点': '质量违约责任',
            '合同内容': '承担修复费用和损失',
            '出现章节': '专用合同条件',
            '风险等级': '中',
            '审核建议': '明确质量标准和责任'
        },

        # 付款条款
        {
            '要素类别': '付款条款',
            '审核要点': '预付款',
            '合同内容': '10%（含安措费）',
            '出现章节': '专用合同条件',
            '风险等级': '中',
            '审核建议': '确认预付款扣回方式'
        },
        {
            '要素类别': '付款条款',
            '审核要点': '发票要求',
            '合同内容': '9%增值税专用发票',
            '出现章节': '专用合同条件',
            '风险等级': '中',
            '审核建议': '确认税率适用性'
        },
        {
            '要素类别': '付款条款',
            '审核要点': '农民工工资支付',
            '合同内容': '设立专用账户',
            '出现章节': '专用合同条件',
            '风险等级': '高',
            '审核建议': '确保符合农民工工资支付条例'
        },

        # 验收条款
        {
            '要素类别': '验收条款',
            '审核要点': '竣工验收条件',
            '合同内容': '工程具备约定条件后申请',
            '出现章节': '专用合同条件',
            '风险等级': '中',
            '审核建议': '明确具体验收标准'
        },
        {
            '要素类别': '验收条款',
            '审核要点': '竣工后试验',
            '合同内容': '包含',
            '出现章节': '专用合同条件',
            '风险等级': '中',
            '审核建议': '确认试验内容和标准'
        },

        # 争议解决
        {
            '要素类别': '争议解决',
            '审核要点': '争议解决方式',
            '合同内容': '未明确约定',
            '出现章节': '专用合同条件',
            '风险等级': '高',
            '审核建议': '建议明确约定仲裁或诉讼'
        },
        {
            '要素类别': '争议解决',
            '审核要点': '管辖法院/仲裁机构',
            '合同内容': '未明确',
            '出现章节': '专用合同条件',
            '风险等级': '高',
            '审核建议': '必须明确约定'
        },

        # 生效条件
        {
            '要素类别': '生效条件',
            '审核要点': '合同生效条件',
            '合同内容': '双方签字或盖章后成立，双方法定代表人或委托代理人签字或盖章并加盖单位公章生效',
            '出现章节': '合同协议书',
            '风险等级': '中',
            '审核建议': '确认签字盖章真实性'
        },

        # 其他重要条款
        {
            '要素类别': '其他重要条款',
            '审核要点': '联合体责任',
            '合同内容': '承担连带责任',
            '出现章节': '专用合同条件',
            '风险等级': '高',
            '审核建议': '确认联合体协议'
        },
        {
            '要素类别': '其他重要条款',
            '审核要点': '分包限制',
            '合同内容': '执行通用条款',
            '出现章节': '专用合同条件',
            '风险等级': '中',
            '审核建议': '明确分包范围和限制'
        }
    ]

    # 创建DataFrame
    df = pd.DataFrame(audit_items)

    # 保存为CSV和Excel
    csv_file = "/root/long_text_review/test_file/contract_audit_summary.csv"
    excel_file = "/root/long_text_review/test_file/contract_audit_summary.xlsx"

    df.to_csv(csv_file, index=False, encoding='utf-8-sig')
    df.to_excel(excel_file, index=False)

    # 按风险等级分组显示
    print("=== 合同审核要点汇总表 ===\n")

    # 按风险等级排序
    risk_order = {'高': 0, '中': 1, '低': 2}
    df['risk_rank'] = df['风险等级'].map(risk_order)
    df_sorted = df.sort_values('risk_rank').drop('risk_rank', axis=1)

    # 分组显示
    for risk in ['高', '中', '低']:
        risk_items = df_sorted[df_sorted['风险等级'] == risk]
        if not risk_items.empty:
            print(f"\n【{risk}风险级别 - {len(risk_items)}项】")
            for _, item in risk_items.iterrows():
                print(f"\n{item['审核要点']}:")
                print(f"  内容: {item['合同内容']}")
                print(f"  章节: {item['出现章节']}")
                print(f"  建议: {item['审核建议']}")

    print(f"\n=== 统计信息 ===")
    print(f"总审核要点: {len(df)} 项")
    print(f"高风险: {len(df[df['风险等级']=='高'])} 项")
    print(f"中风险: {len(df[df['风险等级']=='中'])} 项")
    print(f"低风险: {len(df[df['风险等级']=='低'])} 项")

    print(f"\n报告已保存:")
    print(f"- CSV格式: {csv_file}")
    print(f"- Excel格式: {excel_file}")

if __name__ == '__main__':
    create_concise_audit_table()